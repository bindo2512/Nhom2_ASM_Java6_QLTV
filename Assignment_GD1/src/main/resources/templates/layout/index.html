<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" th:fragment="dynamic(main)">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- Link to FontAwesome CSS -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

<!-- Liên kết Boostrap 5 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
	crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<!-- Liên kết Scroll -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
<link href='https://fonts.googleapis.com/css?family=Josefin Sans'
rel='stylesheet'>
</head>
<body ng-app="library-app" ng-controller="library-ctrl">
	<nav>
		<div th:replace="/layout/_navbar.html"></div>
	</nav>
	<div>
		<div th:replace="${main}"></div>
	</div>
	<script type="text/javascript">
		const app = angular.module("library-app", []);

app.controller("library-ctrl", function($scope, $http){
    $scope.cart = {
        items: [],
		number: 0,
        add(bookid) {
            var item = this.items.find(item => item.bookid == bookid);
			if (item) {
				alert("Bạn chỉ được mượn 1 quyển sách cùng loại vào 1 thời điểm")
			} else {
				$http.get(`/rest/book/${bookid}`).then(resp => {
					resp.data.qty = 1;
					this.items.push(resp.data);
					this.saveStorage();
				})
			}
        },
		remove(id) {
			var index = this.items.findIndex(item => item.bookid == id);
			this.items.splice(index, 1);
			this.saveStorage();
		},
		clear(){
			this.items = [];
			localStorage.clear();
			this.saveStorage();
		},
		count() {
			return this.items.length;
		},
		saveStorage() {
			var json = JSON.stringify(angular.copy(this.items));
			localStorage.setItem("cart", json);
		},
		loadStorage() {
			var json = localStorage.getItem("cart")
			this.items = json ? JSON.parse(json) : [];
		},
    }
	$scope.retail = {
		retailDate: new Date(),
		returnDate: new Date(),
		get bookId() {
			return $scope.cart.items.map(item => {
				return { bookid: item.bookid,}
			})
		},
		rental() {
			var rental = angular.copy(this);
			$http.post("/rest/rental", order).then(resp => {
				alert("Đặt mượn thành công, hãy đến thư viện để trực tiếp nhận sách");
				$scope.cart.clear();
				localtion.href = "/user/rental/detail" + resp.data.id;
			}).catch(error => {
				alert("Đặt sách lỗi");
				console.log(error)
			})
		}
	}
	$scope.cart.loadStorage();
})
	</script>
</body>
</html>