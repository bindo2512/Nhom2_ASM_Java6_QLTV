<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" th:fragment="dynamic(main)">
<head>
<meta charset="UTF-8">
<title>Library of Alexandria</title>
<link rel="icon" type="image/x-icon" href="https://st2.depositphotos.com/1353632/9797/v/450/depositphotos_97976010-stock-illustration-architecture-symbol-circle.jpg">
<!-- Link to FontAwesome CSS -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

<!-- Liên kết Boostrap 5 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
	crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<!-- Liên kết Scroll -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Josefin Sans'
rel='stylesheet'>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
<script
src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-route.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>


</head>
<body ng-app="library-app" ng-controller="library-ctrl">
	<nav>
		<div th:replace="/layout/_navbar.html"></div>
	</nav>
	<div>
		<div th:replace="${main}"></div>
		<h1 >{{qoutes.qoute}}</h1>
	</div>
	<footer>
		<div th:replace="/layout/_footer.html"></div>
	</footer>
	<script type="text/javascript">
		const app = angular.module("library-app", []);

app.controller("library-ctrl", function($scope, $http, $document){
	$scope.qoutes = {};
	$scope.qouteHidden = 'none';
    $scope.cart = {
        items: [],
		number: 0,
        add(bookid) {
            var item = this.items.find(item => item.bookid == bookid);
			if (item) {
				alert("Bạn chỉ được mượn 1 quyển sách cùng loại vào 1 thời điểm")
			} else {
				$http.get(`/rest/book/${bookid}`).then(resp => {
					resp.data.qty = 1;
					this.items.push(resp.data);
					this.saveStorage();
				})
			}
        },
		remove(id) {
			var index = this.items.findIndex(item => item.bookid == id);
			this.items.splice(index, 1);
			this.saveStorage();
		},
		clear(){
			this.items = [];
			localStorage.clear();
			this.saveStorage();
		},
		count() {
			return this.items.length;
		},
		saveStorage() {
			var json = JSON.stringify(angular.copy(this.items));
			localStorage.setItem("cart", json);
		},
		loadStorage() {
			var json = localStorage.getItem("cart")
			this.items = json ? JSON.parse(json) : [];
		},
    }
	$scope.retail = {
		retaildate: "",
		returndate: new Date(),
		name:"",
		address:"",
		phonenumber:"",
		email: "",
		active: false,
		updateReturnDate: function() {
    	if ($scope.retail.returndate) {
			$scope.retail.returndate = new Date($scope.retail.retaildate);
			$scope.retail.returndate.setMonth($scope.retail.retaildate.getMonth() + 1);
    	}
		return $scope.retail.returndate
	},
		account: {username: $("#username").text()},
		get rdetail(){
			return $scope.cart.items.map(item => {
				return {
					book: {bookid: item.bookid},
				}
			})
		},
		rental() {
			var rental = angular.copy(this);
			$http.post("/rest/rental", rental).then(resp => {
				alert("Đặt mượn thành công, hãy đến thư viện để trực tiếp nhận sách");
				$scope.cart.clear();
				location.href = "/user/rental/detail/" + resp.data.retailid;
			}).catch(error => {
				alert("Đặt sách lỗi");
				console.log(error)
			})
		}
	}
	if ($scope.qouteHidden == 'none') {
		setTimeout(function() {
			$scope.qouteHidden = 'block';
			alert($scope.qouteHidden);
			$http({method: 'get', url: 'https://api.api-ninjas.com/v1/quotes', headers: {'X-Api-Key':'x9nN+gyGD6YENIbe0uTBWA==fghWSfyv6nAKYTy2'}, contentType: 'application/json'}).then(resp => {
				console.log(resp.data)
				$scope.qoutes = resp.data;
				console.log($scope.qoutes)
			}).catch(error => {
				console.log(error)
			})
			setTimeout(function() {
				$scope.qouteHidden = 'none';
			}, 15000)
		}, 30000)
	}
	console.log($scope.isLogin)
	$scope.cart.loadStorage();
})
	</script>
	<script th:src="@{|/assest/js/adminBook/script.js|}"></script>
	<script th:src="@{|/assest/js/adminRental/script.js|}"></script>
	<script th:src="@{|/assest/js/rentalHistory/script.js|}"></script>
	<script th:src="@{|/assest/js/adminAccount/script.js|}"></script>
</body>
</html>